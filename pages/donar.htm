title = "Donar Nueva Familia"
url = "/donar"
layout = "default"
meta_title = "Donar"
is_hidden = 0
==

function onStart(){

   $mp = new MP ("4944856265001812", "3OAxUteEVdaM3yNWRImXgxOZvM9Knkp5");

   //********************
   //Donar 500
   $preference500_data = array(
        "items" => array(
            array(
                "title" => "Donar por unica vez $ 500",
                "quantity" => 1,
                "currency_id" => "ARS", // Available currencies at: https://api.mercadopago.com/currencies
                "unit_price" => 500.00
            )
        )
    );
    $preference500= $mp->create_preference ($preference500_data);
    // dd($preference500);
    $this['preference500ID'] = $preference500['response']['init_point'];
    //dd($this['preference500ID']);

    //********************
    //Donar 1000
    $preference1000_data = array(
        "items" => array(
            array(
                "title" => "Donar por unica vez $ 1000",
                "quantity" => 1,
                "currency_id" => "ARS", // Available currencies at: https://api.mercadopago.com/currencies
                "unit_price" => 1000.00
            )
        )
    );
    $preference1000 = $mp->create_preference ($preference1000_data);
    // dd($preference1000);
    $this['preference1000ID'] = $preference1000['response']['init_point'];
    //dd($this['preference1000ID']);

    //********************
    //Donar 2000
    $preference2000_data = array(
        "items" => array(
            array(
                "title" => "Donar por unica vez $ 2000",
                "quantity" => 1,
                "currency_id" => "ARS", // Available currencies at: https://api.mercadopago.com/currencies
                "unit_price" => 2000.00
            )
        )
    );
    $preference2000 = $mp->create_preference ($preference2000_data);
    // dd($preference2000);
    $this['preference2000ID'] = $preference2000['response']['init_point'];
    //dd($this['preference2000ID']);

    //subscription
    $start_date = Carbon\Carbon::now();
    $start_date->addHour(1);
    $end_date = Carbon\Carbon::now();
    $end_date->addMonths(11);

    $start_date = date("Y-m-d\TH:i:s.000P",strtotime($start_date));
    $end_date  = date("Y-m-d\TH:i:s.000P",strtotime($end_date));

    $preapproval_data_500 = array(
      "payer_email" => "info@nuevafamilia.org",
      "back_url" => "http://lacasita.ong/donar",
      "reason" => "Suscripcion mensual",
      "external_reference" => "OP-1234",
      "auto_recurring" => array(
      "frequency" => 1,
      "frequency_type" => "months",
      "transaction_amount" => 500,
      "currency_id" => "ARS",
      "start_date" => $start_date,
      "end_date" =>  $end_date
    )
    );

    $preapproval = $mp->create_preapproval_payment($preapproval_data_500);
    $this['preapproval500ID'] = $preapproval['response']['init_point'];

    $preapproval_data_1000 = array(
      "payer_email" => "info@nuevafamilia.org",
      "back_url" => "http://lacasita.ong/donar",
      "reason" => "Suscripcion mensual",
      "external_reference" => "OP-1234",
      "auto_recurring" => array(
      "frequency" => 1,
      "frequency_type" => "months",
      "transaction_amount" => 1000,
      "currency_id" => "ARS",
      "start_date" => $start_date,
      "end_date" =>  $end_date
    )
    );

    $preapproval = $mp->create_preapproval_payment($preapproval_data_1000);
    $this['preapproval1000ID'] = $preapproval['response']['init_point'];

    $preapproval_data_2000 = array(
      "payer_email" => "info@nuevafamilia.org",
      "back_url" => "http://lacasita.ong/donar",
      "reason" => "Suscripcion mensual",
      "external_reference" => "OP-1234",
      "auto_recurring" => array(
      "frequency" => 1,
      "frequency_type" => "months",
      "transaction_amount" => 2000,
      "currency_id" => "ARS",
      "start_date" => $start_date,
      "end_date" =>  $end_date
    )
    );

    $preapproval = $mp->create_preapproval_payment($preapproval_data_2000);
    $this['preapproval2000ID'] = $preapproval['response']['init_point'];

}


==

    <!-- page title -->
    <div class="page-title-section">
      <div class="page-title-wrap">
        <div class="page-title-overlay"></div>
        <div class="page-title-info">
          <h1 class="page-title">Donar</h1>
        </div>
      </div>
    </div>

    <!-- shop page -->
    <div class="shop-page pd-top-40 pd-bottom-60">
      <div class="container-fluid">
        <div class="row donate_system">
          <div class="col-sm-6 col-md-4">
            <div class="thumbnail">
              <img src="themes\MiCasita\assets\logo\mercadopago.png" alt="logo mercado pago" class="thumb_donate">
              <div class="caption">
                <h3>Quiero donar por unica vez</h3>
                <p>Cliqueando en cada boton Ud. donara por unica vez mediante Mercado Pago</p>
                <p>
                    <button type="button" class="btn btn-lg btn-primary"><a href="{{ preference500ID }}" role="button">$ 500</a></button>
                    <button type="button" class="btn btn-lg btn-primary"><a href="{{ preference1000ID }}" role="button">$ 1000</a></button>
                    <button type="button" class="btn btn-lg btn-primary"><a href="{{ preference2000ID }}" role="button">$ 2000</a></button>
                </p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4">
            <div class="thumbnail">
              <img src="themes\MiCasita\assets\logo\mercadopago.png" alt="logo mercado pago" class="thumb_donate">
              <div class="caption">
                <h3>Quiero donar mensualmente un monto fijo</h3>
                <p>Cliqueando en cada boton Ud. donara un monto fijo mensual mediante Mercado Pago</p>
                <p>
                  <button type="button" class="btn btn-lg btn-primary"><a href="{{ preapproval500ID }}" role="button">$ 500</a></button>
                  <button type="button" class="btn btn-lg btn-primary"><a href="{{ preapproval1000ID }}" role="button">$ 1000</a></button>
                  <button type="button" class="btn btn-lg btn-primary"><a href="{{ preapproval2000ID }}" role="button">$ 2000</a></button>
                </p>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4">
            <div class="thumbnail">
              <img src="themes\MiCasita\assets\logo\ICBC_logo.png" alt="logo mercado pago" class="thumb_donate">
              <div class="caption bank">
                <h3>Si queres hacer el deposito bancario directo desde tu cuenta de banco te damos los datos de La Casita:</h3>
                <p>CTA CORRIENTE NR. 0832/02100016/94</p>
                <p>TITULAR: CASA DEL NIÃ‘O NUEVA FAMILIA</p>
                <p>CBU: 0150832902000100016941</p>
                <p>ALIAS PARA TRANSFERENCIAS: SUMATE.Y.DONA CUIT: 30 70752599 8 </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
